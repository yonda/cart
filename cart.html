<!DOCTYPE HTML>
<html lang="ja-JP">
<head>
<meta charset="utf-8">
<meta name='viewport' content='width=device-width, initial-scale=1'>
<link rel="shortcut icon" type="image/x-icon" href="http://sterfield.co.jp/admin/wp-content/themes/sterfield/images/favicon.ico" />
<link rel="icon" type="image/x-icon" href="http://sterfield.co.jp/admin/wp-content/themes/sterfield/images/favicon.ico" />
<title>カートインのアニメーション</title>

<style type="text/css">
html, body {
    font-family: "游ゴシック体", "Yu Gothic", YuGothic, "ヒラギノ角ゴ Pro","Hiragino Kaku Gothic Pro","メイリオ",Meiryo,Osaka,"ＭＳ Ｐゴシック","MS PGothic",sans-serif;
    font-size: 10px;
}
*{
    padding: 0;
    margin: 0;
}
*,
*::before,
*::after {
    box-sizing: border-box;
}
body{
    background: #f4f3f3;
    color: #2c2c2c;
    letter-spacing: 0.025em;
    line-height: 1.5;
}
header {
    padding: 60px 0;
    text-align: center;
    position: relative;
    transform: translate3d(0, 0, 0);
}
.cart{
  display: table;
  width: 75px;
  position: fixed;
  right: 30px;
  top: 30px;
}
.cart__button {
  display: table-cell;
  height: 75px;
  padding: 10px;
  border-radius: 50%;
  background: rgb(236, 92, 46);
  box-shadow: 0 10px 25px rgba(236, 92, 46, 0.5);
  color: #fff;
  font-size: 1.2rem;
  text-align: center;
  text-decoration: none;
  vertical-align: middle;
  -webkit-transition: 0.5s;
  -ms-transition: 0.5s;
  transition: 0.5s;
}
.cart__button:hover,
.cart__button.is-active {
  background: rgb(255,132,31);
  box-shadow: 0 15px 35px rgba(255,132,31, 0.5);
}
.cart__button.is-active {
  -webkit-transform: scale(1.1);
  -ms-transform: scale(1.1);
  transform: scale(1.1);
}
.cart__icon {
  display: block;
  width: 32px;
  margin: 0 auto;
}
.cartButton {
  margin-top: 10px;
}
.cartButton__button {
  width: 100%;
  height: 44px;
  border: none;
  border-radius: 22px;
  background: rgb(236, 92, 46);
  box-shadow: 0 5px 15px rgba(236, 92, 46, 0.5);
  color: #fff;
  -webkit-appearance: none;
  -webkit-transition: 0.5s;
  -ms-transition: 0.5s;
  transition: 0.5s;
}
.cartButton__button:hover,
.cartButton__button.is-active {
  background: rgb(255,132,31);
  box-shadow: 0 10px 25px rgba(255,132,31, 0.5);
}
.cartButton__button.is-already {
  border: solid 2px rgb(255,132,31);
  background: #fff;
  color: rgb(255,132,31);
  box-shadow: none;
}
.cartButton__num {
  font-weight: bold;
}
.ball {
  width: 44px;
  height: 44px;
  border-radius: 50%;
  background: rgb(255,132,31);
  box-shadow: 0 10px 25px rgba(255,132,31, 0.5);
  position: fixed;
  left: 0;
  top: 0;
  -webkit-transform: translate(-50%, 0);
  -ms-transform: translate(-50%, 0);
  transform: translate(-50%, 0);
}
h1 {
    font-size: 2.4rem;
}
main {
    display: block;
    max-width: 840px;
    padding: 0 60px;
    margin: 0 auto 60px;
}
section {
  padding: 30px;
  margin-bottom: 60px;
  background: #fff;
  font-size: 1.4rem;
}
.archive_figures img {
  width: 16.6%;
}

img {
  max-width: 100%;
}
input[type="text"],
input[type="password"],
input[type="email"],
input[type="tel"],
input[type="search"],
input[type="url"],
input[type="number"],
textarea {
  max-width: 100%;
  min-height: 32px;
  padding: 5px;
  border: solid 2px #8e95b1;
  border-radius: 4px;
  box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.25);
}
h2 {
  margin-bottom: 20px;
  font-size: 24px;
  text-align: center;
}
.archive {
  display: -webkit-flex;
  display: flex;
  -webkit-flex-wrap: wrap;
  flex-wrap: wrap;
  margin: 0 -10px;
}
.archive__item {
  width: 25%;
  padding: 0 10px;
  margin-bottom: 20px;
  list-style: none;
}
button:focus {
  outline: none;
}


footer {
    padding: 30px;
    margin-top: 120px;
    background: rgba(255, 255, 255, 0.75);
    text-align: center;
    position: relative;
    transform: translate3d(0, 0, 0);
}



@media only screen and (max-width: 959px) {

  html, body {
      font-size: 10px;
  }
  header {
      padding: 15px 15px 0;
  }
  main {
      margin-top: 30px;
      padding: 15px;
  }
  section {
    padding: 15px;
  }
  .archive__item {
    width: 50%;
  }
  footer {
    margin-top: 60px;
  }

}
</style>
<script>document.createElement("main");</script>
</head>

<body>
<div class="wrapper">
  <header>
      <h1>カートインのアニメーション</h1>
  </header>
  <nav>
    <p class="cart"><a class="cart__button" href="#"><svg class="cart__icon" viewBox="0 0 512 512">
      <path d="M179.7,388.5c-24.8,0-45,20.2-45,45c0,24.8,20.2,45,45,45s45-20.2,45-45C224.7,408.7,204.5,388.5,179.7,388.5z
         M179.7,453.4c-11,0-19.9-8.9-19.9-19.9c0-11,8.9-19.9,19.9-19.9s19.9,8.9,19.9,19.9C199.6,444.5,190.6,453.4,179.7,453.4z" fill="#fff"/>
      <path d="M408.6,388.5c-24.8,0-45,20.2-45,45c0,24.8,20.2,45,45,45s45-20.2,45-45C453.7,408.7,433.5,388.5,408.6,388.5z
         M408.6,453.4c-11,0-19.9-8.9-19.9-19.9c0-11,8.9-19.9,19.9-19.9c11,0,19.9,8.9,19.9,19.9C428.5,444.5,419.6,453.4,408.6,453.4z" fill="#fff"
        />
      <path d="M383.7,171.8H203.6c-6.9,0-12.6,5.6-12.6,12.6s5.6,12.6,12.6,12.6h180.1c6.9,0,12.6-5.6,12.6-12.6
        C396.3,177.4,390.7,171.8,383.7,171.8z" fill="#fff"/>
      <path d="M373.9,237H213.4c-6.9,0-12.6,5.6-12.6,12.6c0,6.9,5.6,12.6,12.6,12.6h160.5c6.9,0,12.6-5.6,12.6-12.6
        C386.5,242.7,380.9,237,373.9,237z" fill="#fff"/>
      <path d="M506.3,115.7c-4.8-5.9-11.9-9.3-19.5-9.3H95.3l-7.9-38.4c-1.7-8-7.1-14.7-14.6-18l-55.2-24C11.2,23.4,3.8,26.3,1,32.7
        c-2.8,6.4,0.2,13.8,6.5,16.5l55.2,24l60.8,295.3c2.4,11.6,12.8,20.1,24.6,20.1h301.2c6.9,0,12.6-5.6,12.6-12.6
        c0-6.9-5.6-12.6-12.6-12.6H148.2l-7.4-35.9h310.9c11.9,0,22.2-8.4,24.6-20.1l35.2-170.7C513,129.3,511.1,121.6,506.3,115.7z
         M451.7,302.3H135.6l-35.2-170.7l386.4,0L451.7,302.3z" fill="#fff"/>
    </svg><span class="cartButton__num">0</span></a></p>
  </nav>
  <main>
    <section>
      <p class="cartButton"><button type="button" class="cartButton__button">カートに入れる</button></p>
    </section>
  </main>
</div>
<script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
<script>
(function() {
  var requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame ||
　　　　　　　　　　　　　　　　　　　window.msRequestAnimationFrame;
  window.requestAnimationFrame = requestAnimationFrame;
})();

$(function() {
  var $target = $(".cart"), //ナビゲーションのカートボタン
      $cartNum = $target.find(".cartButton__num"), //カートに入れるボタン
      $window = $(window),
      targetPos, buttonPos;

  //カートに入れるボタンを押したら実行
  $(document).on("click", ".cartButton__button:not(.is-active)", function() {
    //「ナビゲーションのカートボタン」と「カートに入れるボタン」の位置を取得
    var $self = $(this),
        targetPos = $target.offset(),
        buttonPos = $self.offset();
    targetPos.top = targetPos.top - $window.scrollTop();
    buttonPos.top = buttonPos.top - $window.scrollTop();

    targetPos.left = targetPos.left + $target.width() / 2;
    buttonPos.left = buttonPos.left + $self.width() / 2;

    var G = 10, //重力[px/s^2]
        v = 0, //初速[px/s]
        H = buttonPos.top - targetPos.top, //高度[px]
        S = targetPos.left - buttonPos.left; //距離[px]

    calcOrbit();

    /**
     * 放物線の軌道を計算
     */
    function calcOrbit() {
      //解の存在の有無判定に使う値
      var b = -1 * (2 * v * v * S) / (G * S * S),
          c = 1 + (2 * v * v * H) / (G * S * S);

      var D = b * b - 4 * c; //0以上なら解が存在
      if(D >= 0) {
        //解が存在する場合はアニメーションを実行

        //放物線の最初の角度を算出
        var tanTheta0 = Math.atan((-b - Math.sqrt(D)) / 2),
            tanTheta1 = Math.atan((-b + Math.sqrt(D)) / 2),
            theta = Math.max(tanTheta0, tanTheta1);

        //アニメーションを実行
        startAnimation();
      } else {
        //解が存在しない場合は、初速を追加して放物線の軌道を再計算
        v++;
        calcOrbit();
      }

      /**
       * アニメーションを実行
       */
      function startAnimation() {
         //アニメーションさせるボールを設置
        $("body").append('<div class="ball" />');
        var $ball = $(".ball").last();
        $ball.css({
          "left": buttonPos.left + "px",
          "top": buttonPos.top + "px"
        });
//        $self.addClass("is-active").text("処理中");

        //アニメーション実装
        var startTime = performance.now();
        requestAnimationFrame(loop);
        function loop(nowTime) {
          var t = (nowTime - startTime) / 50, //時間を取得
              x = v * Math.cos(theta) * t, //横方向の位置を算出
              y = Math.tan(theta) * x - (G / (2 * v * v * Math.cos(theta) * Math.cos(theta))) * x * x; //縦方向の位置を算出
          //算出した値を基にボールの位置を移動
          $ball.css({
            "left": Math.round(buttonPos.left + x) + "px",
            "top": Math.round(buttonPos.top - y) + "px"
          });
          //ボールがカートボタンに到着するまでアニメーションを実行
          if(buttonPos.left + x < targetPos.left) {
            requestAnimationFrame(loop);
          } else {
            //アニメーションの終了処理
            $ball.remove();
//            $target.children().addClass("is-active");
            $cartNum.text(Number($cartNum.text()) + 1);
//            $self.text("カートに入れました").addClass("is-already");
            var timer = setTimeout(function() {
              clearInterval(timer);
//              $target.children().removeClass("is-active");
            }, 1000);
          }
        }
      }
    }

  });
});
</script>
</body>
</html>
